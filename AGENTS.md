<!-- Ctrl + K V -->

# AGENTS.md（Codex/エージェント向け）

 最初に ProjectPolicy.md を読んで、プロジェクト全体の運用ルールを把握し、全体として方針はこられに従う。
 AIとのチャットのやり取りは日本語を使用する。

## AIの基本ルール
- AIは git コマンドを基本的には実行しない。(必要なら確認を取ってから実行する)
  git mv など、どうしてもAIが実行した方が効率が良い場合は、確認しながら実行する。

- AIは作業に時間が見込まれる場合（1分以上）、先に時間がかかることをメッセージとして出力して、最終的に BurnToast で作業完了を通知する。
  その際、Toastの実行承認を不要にするため AIへの依頼はターミナル実行から行う。（要 Node.js と @openai/codex）

  例）
    .\run-codex.ps1 -Prompt "index.htmlのファイルサイズを教えて"

## ソースコード(共通)
- 圧縮（minify）、を前提としたコードを作成すること。
- 圧縮後も、コードが変わる可能性もゼロではないので、AIにチェックさせる。

  > wwwを minify した dist フォルダ 内のファイルを静的チェック（HTML/CSS/JS の構文チェック（lint）レベル）して。使うツールはお任せします。
  > wwwを minify した dist フォルダは、内容としては同じはずです。ブラウザで見るレベルで同じになっているか、精査してください。
  > dist と www を比較するとき、ファイルを改変しないのなら、こちらにコマンド実行の可否を確認する必要は無いです。

- 将来的に 難読化 も対応するので、それを前提としたコードを作成すること。
- 将来的に 最終的に 難読化 → 圧縮、の順にBuildすること。

- フォルダ内にファイルが多くなってきたときは、適切なフォルダ分け、階層分けをすること。

## ソースコード(*.html)
- 画面遷移の仕様に従って（ preconnect / preload / modulepreload / prefetch ） を入れる。

- index.html 以外の画面は noindex を入れて、検索サイトに「そのページを検索結果に出さないで」と伝える

- 英語と日本語の翻訳に関しては、以下のようにする。翻訳箇所に英語と日本語を用意する。
- ただし、操作画面の Back / Done は翻訳不要です。

  例）
    <span class="lang" data-lang="en">Manual</span>
    <span class="lang" data-lang="ja">使い方</span>

- HTML内の aria-label 属性は英語表記を使用する。

- HTMLではスクロールバーを強制的に非表示にしない。

## ソースコード(*.js)
- 各ファイルの先頭に、ファイルの役割・クラスの役割など、そのファイル単位の役割や仕様をコメントで記載する。

- ES module で統一する。(圧縮時の処理安定も兼ねるための対策)

- index.html 以外の画面をブックマーク等で直接開いた場合は、index.html へ転送する処理。（フォールバック）

- ブラウザ内の操作の画面遷移は、同一タブ内の画面遷移を前提とし、Back/Done は history.back() で戻る。（履歴が無い場合は index.html へ戻す）
  ただし、フッターの外部WEBサイトへのリンクは別タブのリンクとする。
  また、外部ファイル（PDFなど）への保存操作時も別タブ表示で問題ないとする。

- 外部からもってきらライブラリは lib フォルダで管理する。
- 外部からもってきらライブラリの内、ライセンスファイルの同梱が必要な場合 assets/licenses フォルダ内に入れる。

## ソースコード(*.css)
- 各種属性にはコメントを追加して、後から手動で編集しやすくしておく。

- 縦長の画面は svh/dvh を html / body に適用することを検討する。（勝手にスクロールす現象が抑えれます。）
- 横長の画面で editScore の画面で、スマホ横持ち時の対応として、min-height を指定する。
  例）
    min-height: 100svh;
    min-height: 100dvh;


### コメント
- コメントは日本語で書く
- HTMLで、`<!--Spec -->`で書かれたコメントは仕様なので、コード改変時には原則削除しない。どうしても変更が必要な場合は、確認する。
- JavaScriptで、`//##Spec` や `/*##Spec */`で書かれたコメントは仕様なので、コード改変時には原則削除しない。どうしても変更が必要な場合は、確認する。
- 関数を作成したら、関数ヘッダコメントを作成すること。
- 処理にも適宜コメントを挿入すること。


### 改変の範囲に関して
- ワークスペース内のソースコードを修正すること。
- ワークスペース外のソースコードや設定ファイルをどうしても修正する必要があれば、確認してOKなら変更すること。

### 内部・外部保存に関して
- ファイルやIndexeDBはLocalStrageなど、保存仕様を変更する場合は、確認してから変更する。
- ファイルやIndexeDBはLocalStrageなど、保存仕様を拡張する場合は、以前の仕様を変更して処理できなくなる場合は、確認してから変更すること。

- PDF の添付ファイルについては、Acrobat Reader DCで確認できる。右のクリップアイコンから確認。（添付ファイルの確認は開発用）

## リリース前の静的チェックに関して
- AIは コマンド `npm run build` は 実行しない。(開発者が実行する)

## デバッグに関して
- 難解な不具合原因を追う必要があるとき（不具合は起きるけど原因が分からないの不具合を調べるとき）は、動作ステップの分かるログ出力コードを細かく挿入する。
- 挿入した動作ステップ状況（どこまで動作して、どういった変数になったか）の情報をAIと人がやり取りすることで原因を究明していくこと。

