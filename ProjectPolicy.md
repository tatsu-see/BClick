
<!-- Ctrl + K V -->

# アプリ名：B.Click

---

  > ProjectPolicy.md を最初に読んでください。このアプリの開発は、ProjectPolicy.md に書かれたルールに沿って進めること。
  > 特にAIが自動作成するコードは、このルールに沿って作成します。AIとのチャットのやり取りには、日本語を使用すること。

## アプリの目的
ギターのリズム練習用のアプリ


## 見た目のデザイン
- 緑を基調とした色遣いとする。
- 表示部、ボタン部、など同じ機能であれば、基本的に同じ見た目にする。

- 設定項目ラベル   背景：深緑、文字：白系
- 画面遷移ボタン   背景：白系、文字と縁取：太線＋緑系
- 画面内操作ボタン 背景：灰色、文字と縁取：細線＋黒系

## AIに関して
- AIは git コマンドを基本的には実行しない。(必要なら確認を取ってから実行する)
  git mv など、どうしてもAIが実行した方が効率が良い場合は、確認しながら実行する。

- AIは作業に時間が見込まれる場合（1分以上）、先に時間がかかることをメッセージとして出力して、最終的に BurnToast で作業完了を通知する。
  その際、Toastの実行承認を不要にするため AIへの依頼はターミナル実行から行う。（要 Node.js と @openai/codex）

  例）
    .\run-codex.ps1 -Prompt "index.htmlのファイルサイズを教えて"

## ソースコード(共通)
- 圧縮（minify）、を前提としたコードを作成すること。
- 圧縮後も、コードが変わる可能性もゼロではないので、AIにチェックさせる。

  > wwwを minify した dist フォルダ 内のファイルを静的チェック（HTML/CSS/JS の構文チェック（lint）レベル）して。使うツールはお任せします。
  > wwwを minify した dist フォルダは、内容としては同じはずです。ブラウザで見るレベルで同じになっているか、精査してください。
  > dist と www を比較するとき、ファイルを改変しないのなら、こちらにコマンド実行の可否を確認する必要は無いです。

- 将来的に 難読化 も対応するので、それを前提としたコードを作成すること。
- 将来的に 最終的に 難読化 → 圧縮、の順にBuildすること。

- フォルダ内にファイルが多くなってきたときは、適切なフォルダ分け、階層分けをすること。

## ソースコード(*.html)
- 画面遷移の仕様に従って（ preconnect / preload / modulepreload / prefetch ） を入れる。

- index.html 以外の画面は noindex を入れて、検索サイトに「そのページを検索結果に出さないで」と伝える

- 英語と日本語の翻訳に関しては、以下のようにする。翻訳箇所に英語と日本語を用意する。
- ただし、操作画面の Back / Done は翻訳不要です。

  例）
    <span class="lang" data-lang="en">Manual</span>
    <span class="lang" data-lang="ja">使い方</span>

- HTML内の aria-label 属性は英語表記を使用する。

## ソースコード(*.js)
- 各ファイルの先頭に、ファイルの役割・クラスの役割など、そのファイル単位の役割や仕様をコメントで記載する。

- ES module で統一する。(圧縮時の処理安定も兼ねるための対策)

- index.html 以外の画面をブックマーク等で直接開いた場合は、index.html へ転送する処理。（フォールバック）

- ブラウザ内の操作の画面遷移は、同一タブ内の画面遷移を前提とし、Back/Done は history.back() で戻る。（履歴が無い場合は index.html へ戻す）
  ただし、フッターの外部WEBサイトへのリンクは別タブのリンクとする。
  また、外部ファイル（PDFなど）への保存操作時も別タブ表示で問題ないとする。

- 外部からもってきらライブラリは lib フォルダで管理する。
- 外部からもってきらライブラリの内、ライセンスファイルの同梱が必要な場合 assets/licenses フォルダ内に入れる。

## ソースコード(*.css)
- 各種属性にはコメントを追加して、後から手動で編集しやすくしておく。

### コメント
- コメントは日本語で書く

- HTMLで、`<!--Spec -->`で書かれたコメントは仕様なので、コード改変時には原則削除しない。どうしても変更が必要な場合は、確認する。

- JavaScriptで、`//##Spec` や `/*##Spec */`で書かれたコメントは仕様なので、コード改変時には原則削除しない。どうしても変更が必要な場合は、確認する。

- 関数を作成したら、関数ヘッダコメントを作成すること。

- 処理にも適宜コメントを挿入すること。

### 改変の範囲に関して
- ワークスペース内のソースコードを修正すること。
- ワークスペース外のソースコードや設定ファイルをどうしても修正する必要があれば、確認してOKなら変更すること。

### 内部・外部保存に関して
- ファイルやIndexeDBはLocalStrageなど、保存仕様を変更する場合は、確認してから変更する。
- ファイルやIndexeDBはLocalStrageなど、保存仕様を拡張する場合は、以前の仕様を変更して処理できなくなる場合は、確認してから変更すること。

- PDF の添付ファイルについては、Acrobat Reader DCで確認できる。右のクリップアイコンから確認。（添付ファイルの確認は開発用）

## ライブラリに関して

- 使用しているライブラリは、特段の理由がない限りは、利用規約に列挙すること。
- ライセンスが変更なり使えなくなったライブラリは使わないこと。

- 内部で alphaTab を使用している個所は、仕様の参照は以下のサイトから行う。
https://www.alphatab.net/docs/introduction/

alphaTab の Chord 表記の例は下記から、{ch "C"} を検索。
https://next.alphatab.net/docs/alphatex/beat-properties

alphaTab/alphaTex の1段ごとの小節数の表記の例は下記から。
https://alphatab.net/docs/alphatex/score-metadata#defaultsystemslayout

拍子について
https://www.alphatab.net/docs/alphatex/bar-metadata#ts
 
休符について
https://alphatab.net/docs/alphatex/document-structure#beat-content-required

音符表現について
https://alphatab.net/docs/alphatex/document-structure#beats


- 内部で ABCJS を使用している個所は、仕様の参照は以下のサイトから行う。
https://docs.abcjs.net/


- 内部で PDFlib を使用している個所は、仕様の参照は以下のサイトから行う。



## リリース時の圧縮（と難読化）に関して

- アプリのリリースにおいては、圧縮ツールは GitHub Actions の runner 上で実行する。
- runner 上の作業ディレクトリからAzureにスクリプトを送りアプリを公開する。
- このリリースのため *.yml と package.json などのファイルを用意する。
- ファイルが用意出来たら ローカルで確認（ npm install → npm run build ）し、AIに指示を出して確認してもらう。
  例）
    www をミニファイした dist フォルダの中身が、意味は変えずにサイズだけ小さくなっているかチェックしてほしい。
    フォルダ構成と存在するファイルが同一であることの他に、簡易チェックでいいので、チェック方法は任せる。
    （今のところ、スクショ比較 や DOM比較は不要です。）

- コマンド（npm install → npm run build）はrepoフォルダで実行するが、その際に生成される dist , node_modules フォルダは git 管理対象外。
- AIは コマンド `npm run build` は 実行しない。(開発者が実行する)

- 難読化は将来に対応する予定。

## サーバー設定
- キャッシュを有効にする。（時々設定を見直すこと）
- *.html 「キャッシュはするが毎回 revalidate」の設定とする。

- WEB検索から index.html 以外の画面を直接開いたら inded.html へ転送する。

